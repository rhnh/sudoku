var L=["1","2","3","4","5","6","7","8","9"],w=["a","b","c","d","e","f","g","h","i"],v=["start","restart","remove","note","hint","timer"];var m=e=>({map:t=>m(t(e)),fold:t=>t(e),toString:()=>(console.log(e),e)}),K=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],p=()=>{let e=0;return w.map(t=>L.map(n=>{let o=Math.floor(e/9),l=e%9,s=Math.floor(o/3)*3+Math.floor(l/3)+1;return e++,`${t}${n}${s}`})).flat()};function Y(e){let t=new Map;for(let[o,l]of e.entries())t.has(l)||t.set(l,[]),t.get(l).push(o);let n=[];for(let o of t.values())o.length>1&&n.push(...o);return n}var E=e=>t=>p().map(n=>Y(t(n,!0)).map(o=>{if(o){let l=e.cells.get(o);e.duplicates.set(o,`${l}`)}else e.duplicates.delete(o);return e.duplicates}).flat()).flat(),z=e=>{E(e)($(e)),E(e)(P(e)),E(e)(H(e))},f=(e,t)=>{e.duplicates=new Map,e.targetKey&&(e.selected.map(n=>{e.originCell.get(n)!=="0"&&e.originCell.get(n)||(e.cells.set(n,`${t}`),e.userInput.set(n,`${t}`),J(e)&&(e.gameState="isOvered"))}),e.highlight=k(e)(e.targetKey),z(e),u(e))},T=e=>{let t=p();return e.every(n=>n>=0&&n<=8)?t[9*e[0]+e[1]]:void 0};function B(e){let t,n=()=>(t===void 0&&(t=e()),t);return n.clear=()=>{t=void 0},n}var b=e=>(t,n=!1)=>o=>{let l=new Map;for(let[s,r]of e.cells)if(s[o]===t[o]){if(n&&r==="0")continue;l.set(s,r)}return l},$=e=>(t,n=!1)=>b(e)(t,n)(0),P=e=>(t,n=!1)=>b(e)(t,n)(1),H=e=>(t,n=!1)=>b(e)(t,n)(2),k=e=>(t,n=!1)=>new Map([...$(e)(t,n),...P(e)(t,n),...H(e)(t,n)]),R=(e,t)=>{let n=e.bounds().width*t[0]/9,o=e.bounds().height*t[1]/9;return[n,o]},N=e=>{let t=Math.ceil(e/3),n=(e-1)%3+1;return[t,n]},V=e=>t=>{let{board:n}=e,o=n.firstChild;for(;o;){if(o.dataset.key?.startsWith(t))return o;o=o.nextSibling}return null};function g(e){let t=9*e[0]+e[1];return e.every(n=>n>=0&&n<=9)?p()[t]:void 0}var D=w.map((e,t)=>`${e}${t+1}`);var y=e=>(t,n=9,o=9)=>{let l=Math.floor(n*(t[0]-e.left)/e.width),s=Math.floor(o*(t[1]-e.top)/e.height);return l>=0&&l<n&&s>=0&&s<=o?[l,s]:[-1,-1]},h=e=>e,A=()=>{let t=p().slice(0,6),n=new Map;return v.map((o,l)=>{let s=t[l];n.set(s,o)}),n},J=e=>{let{userInput:t,solutions:n}=e,o=n.keys(),l=!1;for(let s of o){if(t.get(s)==="0")return!1;l=!0}return l},I=e=>{let t=Math.floor(e/60),n=e%60,o=l=>l.toString().padStart(2,"0");return`${o(t)}:${o(n)}`};function C(e){let t=e.wrap.getBoundingClientRect(),n=e.container,o=t.height/t.width,l=Math.floor(t.width*window.devicePixelRatio/9)*9/window.devicePixelRatio,s=l*o;n.style.width=l+"px",n.style.height=s+"px",e.bounds.clear(),e.addDimensionsCssVarsTo?.style.setProperty("---cg-width",l+"px"),e.addDimensionsCssVarsTo?.style.setProperty("---cg-height",s+"px")}function O(e){let t=document.createElement("container");if(!t)throw new Error('Not HtmlElement found with id "container"');let n=document.createElement("board");t.appendChild(n);let o=document.createElement("numpad");o.id="numpad";let l=document.createElement("head");l.id="aside";let s=document.createElement("section");s.id="aside";let r=document.createElement("article");r.classList.add("panel"),r.id="panel",s.appendChild(r),s.appendChild(o),t.appendChild(s),e.wrap.append(t);let a=B(()=>t.getBoundingClientRect());return new ResizeObserver(()=>{C(e)}).observe(e.wrap),e={...e,board:n,numPad:o,bounds:a,container:t,panel:r,aside:s},e}function Q(e){let{panel:t,buttons:n,bounds:o}=e;C(e),console.log(e.bounds().width);let l=null;for(let[i,d]of n){let c=document.createElement("button");c.style.height=`${o().height/9}px`,c.style.width=`${o().width/3-1}px`,c.id=`${d.replace(/\s/g,"-")}`.toLowerCase(),c.classList.add(i),c.innerText=`${d.replace(/\s/g,"-")}`,c.style.aspectRatio="1 / 1",c.classList.add("buttons"),t.append(c),l=c}let s=document.createElement("section");s.style.height=`${o().height/9}px`,s.style.width=`${o().width/3-1}px`,s.classList.add("buttons"),s.classList.add("timer"),s.id="timer";let r=document.createElement("p");if(!l)throw Error("Could found the button");l=t.replaceChild(s,l),s.appendChild(r),e.gameState==="isInitialed"&&(r.textContent="00:00");let a=e.seconds?e.seconds:0;return setInterval(()=>{e.gameState==="isPlaying"&&(r.textContent=I(e.seconds),e.seconds=a,a++)},1e3),e}function Z(e){let{board:t}=e,n=document.createElement("h1");n.innerText="Game Over",n.style.width="50%",n.style.height="50%",n.style.transform=`translate(${e.bounds().width/2-90}px,${e.bounds().height/2+20}px)`,n.style.position="absolute",t.appendChild(n)}function u(e){return requestAnimationFrame(()=>{C(e);let{board:t,cells:n}=e;t.innerHTML="",e.gameState==="isOvered"&&Z(e);for(let[o,l]of n){let s=document.createElement("cell"),r=K(o),a=R(e,r);s.style.transform=`translate(${a[0]}px, ${a[1]}px)`,s.style.position="absolute",s.style.height=`${e.bounds().height/9}px`,s.style.width=`${e.bounds().width/9}px`;for(let[d,c]of e.highlight)d===o&&s.classList.add("highlighted");if(e.selected.map(d=>{d===o&&(s.classList.remove("highlighted"),s.classList.remove("duplicates"),s.classList.add("selected"))}),e.duplicates.size>1)for(let[d,c]of e.duplicates)o===d&&(s.classList.remove("highlighted"),s.classList.remove("selected"),s.classList.add("duplicates"));s.dataset.key=`${o}`,s.dataset.value=`${l}`,o.startsWith("a")||o.startsWith("d")||o.startsWith("g")?s.classList.add("vertical-lines-left"):o.startsWith("i")&&s.classList.add("vertical-lines-right"),(o[1]==="1"||o[1]==="4"||o[1]==="7")&&s.classList.add("horizontal-lines-top"),o[1]==="9"&&s.classList.add("horizontal-lines-bottom");let i=document.createElement("p");i.style.gridArea="2 / 2 / 3 / 3",l!=="0"&&e.gameState!=="isInitialed"&&(i.innerHTML=`${l}`),e.gameState==="isPaused"&&(i.style.opacity="0"),s.appendChild(i),t.appendChild(s),e.originCell.get(o)!=="0"&&e.originCell.get(o)?s.classList.add("origin-cells"):(s.classList.remove("origin-cells"),s.classList.add("new-cells")),(e.gameState==="isOvered"||e.gameState==="isPaused")&&(s.style.opacity="0.3"),j(e,s)}}),e}var x=e=>t=>{let n=e.selected?.map(s=>`${s.slice(0,2)}${t}`),o=new Set([...n]);if(e.notes.filter(s=>o.has(s)).length>0){e.notes=e.notes.filter(s=>!o.has(s));return}e.notes=[...new Set([...e.notes,...n])],e.notes=[...new Set([...e.notes])],e.notes=[...e.notes,...new Set(n.filter((s,r)=>e.notes[r]==s))]};function j(e,t){let{notes:n}=e;return n=[...new Set(n)],n.map(o=>{let l=+o.slice(-1),s=o.slice(0,2);if(!t.dataset.key?.startsWith(s)||t.dataset.value!=="0")return;let[r,a]=N(l),i=document.createElement("note");i.style.gridColumn=`${a} / 3`,i.style.gridRow=`${r} / 3`,i.innerHTML=`${l}`,t?.appendChild(i)}),e}var ee=e=>{let{bounds:t,numPad:n}=e;n.innerHTML="",n.style.height=`${t().height/9}px`;for(let[o,l]of e.digits){let s=document.createElement("button");s.classList.add("num"),s.dataset.value=`${l}`,s.innerHTML=`${l}`,s.dataset.key=`${o}`,n.appendChild(s)}return e},te=e=>m(ee(e)).map(F).fold(h),ne=e=>m(e).map(te).map(Q).map(G).fold(h),q=e=>m(e).map(u).map(ne).fold(h);var U=e=>{let{board:t}=e;return t.addEventListener("pointerdown",n=>{let{clientX:o,clientY:l}=n,s=y(e.bounds())([o,l]),r=g(s);if(!r)return;e.highlight=k(e)(r);let a=V(e)(r);if(a)if(a.dataset.value==="0")n.ctrlKey?e.selected=[...new Set(e.selected),r]:e.selected=[...new Set([r])],e.isHold=!0,u(e);else{e.isDragging=!0,e.draggingElement=a,e.selected=e.selected=[...new Set([r])],e.draggingElement.classList.add("selected");let i=e.draggingElement.dataset.value;if(!i)return;e.draggingValue=i}}),t.addEventListener("pointerup",n=>{let{clientX:o,clientY:l}=n;e.isHold=!1;let s=y(e.bounds())([o,l]),r=g(s);if(r){if(e.targetKey=r,e.selected=[...new Set([...e.selected,r])],e.isDragging&&e.draggingElement){let a=e.draggingElement?.firstChild;e.draggingElement&&a&&(a.style.position="unset",a.style.transform="unset"),e.draggingElement.classList.remove("selected"),t.querySelectorAll(".selected").forEach(d=>d.classList.remove("selected"));let i=e.draggingValue;e.isNote?x(e)(i):f(e,i)}e.draggingElement=void 0,e.isDragging=!1,e.draggingValue=void 0,u(e)}}),t.addEventListener("pointermove",n=>{let{clientX:o,clientY:l}=n;if(e.isHold){let s=y(e.bounds())([o,l]),r=g(s);if(!r)return;e.selected=[...new Set(e.selected),r],e.selected=[...new Set(e.selected)],u(e)}if(e.isDragging){let s=e.draggingElement?.firstChild;e.draggingElement&&s&&(s.style.position="absolute",s.style.transform=`translate(${o-e.draggingElement?.getBoundingClientRect().left-e.draggingElement?.getBoundingClientRect().width/3}px, ${l-e.draggingElement?.getBoundingClientRect().top-e.draggingElement?.getBoundingClientRect().height/3}px)`)}}),e},F=e=>{let{numPad:t}=e;return t.querySelectorAll("*").forEach(n=>{let o=n;o.addEventListener("click",()=>{let l=o.dataset.value;l&&(e.isNote?x(e)(l):f(e,l),u(e))})}),e};function W(e){let{panel:t}=e;return document.addEventListener("keydown",n=>{if(n.key==="r"&&document.location.reload(),e.gameState==="isInitialed"&&n.key==="s"&&(e.gameState="isPlaying",u(e)),e.gameState==="isPlaying"&&n.key==="n"){e.isNote=!e.isNote;let s=t.querySelector("#note");e.isNote?s.classList.add("btn-pressed"):s.classList.remove("btn-pressed")}let o=n.key[0];if(o.match(/\d/))if(e.isNote){if(!e.targetKey)return;x(e)(o)}else f(e,`${o}`);u(e)}),e}function G(e){let{panel:t}=e,n=t.querySelector("#start");if(!n)return e;n.addEventListener("pointerdown",()=>{if(e.gameState==="isInitialed"){e.gameState="isPlaying";let i=t.querySelector("#start");i.innerText="Pause",u(e)}else if(e.gameState==="isPaused"){e.gameState="isPlaying";let i=t.querySelector("#start");i.innerText="Pause",u(e)}else if(e.gameState==="isPlaying"){e.gameState="isPaused";let i=t.querySelector("#start");i.innerText="Resume",u(e)}u(e)}),t.querySelector("#restart").addEventListener("pointerdown",()=>{document.location.reload()});let l=t.querySelector("#note");l.addEventListener("pointerdown",()=>{e.isNote=!e.isNote,e.isNote?l.classList.add("btn-pressed"):l.classList.remove("btn-pressed")}),t.querySelector("#remove").addEventListener("pointerdown",()=>{e.isNote||e.selected.map(d=>{e.originCell.get(d)!=="0"||(e.cells.set(d,"0"),e.duplicates=new Map)});let i=e.selected.map(d=>e.notes.filter(c=>d.slice(0,2)===c.slice(0,2))).flat();e.notes=e.notes.filter(d=>!i.includes(d)),u(e)}),t.querySelector("#hint").addEventListener("pointerdown",()=>{e.gameState==="isPlaying"&&e.selected.map(d=>{let c=e.solutions.get(d);f(e,c)})});let a=t.querySelector("#timer");return a&&a.addEventListener("pointerdown",()=>{a.firstChild.classList.toggle("hide")}),e}function _(e,t,n,o){for(let l=0;l<3;l++)for(let s=0;s<3;s++)if(e[t+l][n+s]===o)return!1;return!0}function oe(e,t,n){let o;for(let l=0;l<3;l++)for(let s=0;s<3;s++){do o=Math.floor(Math.random()*9)+1;while(!_(e,t,n,o));e[t+l][n+s]=o}}function se(e,t,n){for(let o=0;o<9;o++)if(e[t][o]===n)return!1;return!0}function le(e,t,n){for(let o=0;o<9;o++)if(e[o][t]===n)return!1;return!0}function re(e,t,n,o){return se(e,t,o)&&le(e,n,o)&&_(e,t-t%3,n-n%3,o)}function ie(e){for(let t=0;t<9;t+=3)oe(e,t,t)}function S(e,t,n){if(t===9)return!0;if(n===9)return S(e,t+1,0);if(e[t][n]!==0)return S(e,t,n+1);for(let o=1;o<=9;o++)if(re(e,t,n,o)){if(e[t][n]=o,S(e,t,n+1))return!0;e[t][n]=0}return!1}function ae(e,t){let n=new Map;for(;t>0;){let o=Math.floor(Math.random()*81),l=Math.floor(o/9),s=o%9;e[l][s]!==0&&(n.set(T([l,s]),e[l][s]),e[l][s]=0,t--)}return n}function X(e){let t=new Array(9).fill(0).map(()=>new Array(9).fill(0));return ie(t),S(t,0,0),{grid:t,removed:ae(t,e)}}function de(){let e=new Map;return D.map((t,n)=>{let o=t,l=+(n+1);e.set(o,l)}),e}var ce=e=>{let t=ue(),n=new Map([...t.cells]),o=new Map;return[...t.solutions.keys()].map(a=>o.set(a,"0")),{...{gameState:"isInitialed",cells:n,originCell:t.cells,selected:[],digits:de(),notes:[],buttons:A(),isNote:!1,isDragging:!1,isHold:!1,highlight:new Map,duplicates:new Map,solutions:t.solutions,userInput:o,seconds:0},wrap:e}},ue=()=>{let e=new Map,t=X(50),n=t.grid.flat(),o=t.removed;return p().map((l,s)=>{let r=Math.floor(s/9),a=s%9,i=Math.floor(r/3)*3+Math.floor(a/3)+1,d=l.replace(/.$/,`${i}`);e.set(d,`${n[s]}`)}),{cells:e,solutions:o}};function Ke(e){return m(ce(e)).map(O).map(q).map(U).map(W)}export{Ke as Sudoku,ue as getCells,de as getDigits,ce as initState};
