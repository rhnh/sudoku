var M=["1","2","3","4","5","6","7","8","9"],b=["a","b","c","d","e","f","g","h","i"],K=["start","restart","remove","note","hint","timer"];var p=e=>({map:t=>p(t(e)),fold:t=>t(e),toString:()=>e}),B=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],f=()=>{let e=0;return b.map(t=>M.map(n=>{let o=Math.floor(e/9),s=e%9,l=Math.floor(o/3)*3+Math.floor(s/3)+1;return e++,`${t}${n}${l}`})).flat()};function Y(e){let t=new Map;for(let[o,s]of e.entries())t.has(s)||t.set(s,[]),t.get(s).push(o);let n=[];for(let o of t.values())o.length>1&&n.push(...o);return n}var E=e=>t=>f().map(n=>Y(t(n,!0)).map(o=>{if(o){let s=e.cells.get(o);e.duplicates.set(o,`${s}`)}else e.duplicates.delete(o);return e.duplicates}).flat()).flat(),J=e=>{E(e)(P(e)),E(e)(R(e)),E(e)(N(e))},g=(e,t)=>{e.duplicates=new Map,e.targetKey&&(e.selected.map(n=>{e.originCell.get(n)!=="0"&&e.originCell.get(n)||(e.cells.set(n,`${t}`),e.userInput.set(n,`${t}`),Q(e)&&(e.gameState="isOvered"))}),e.highlight=k(e)(e.targetKey),J(e),c(e))},$=e=>{let t=f();return e.every(n=>n>=0&&n<=8)?t[9*e[0]+e[1]]:void 0};function H(e){let t,n=()=>(t===void 0&&(t=e()),t);return n.clear=()=>{t=void 0},n}var v=e=>(t,n=!1)=>o=>{let s=new Map;for(let[l,r]of e.cells)if(l[o]===t[o]){if(n&&r==="0")continue;s.set(l,r)}return s},P=e=>(t,n=!1)=>v(e)(t,n)(0),R=e=>(t,n=!1)=>v(e)(t,n)(1),N=e=>(t,n=!1)=>v(e)(t,n)(2),k=e=>(t,n=!1)=>new Map([...P(e)(t,n),...R(e)(t,n),...N(e)(t,n)]),V=(e,t)=>{let n=e.bounds().width*t[0]/9,o=e.bounds().height*t[1]/9;return[n,o]},A=e=>{let t=Math.ceil(e/3),n=(e-1)%3+1;return[t,n]},D=e=>t=>{let{board:n}=e,o=n.firstChild;for(;o;){if(o.dataset.key?.startsWith(t))return o;o=o.nextSibling}return null};function y(e){let t=9*e[0]+e[1];return e.every(n=>n>=0&&n<=9)?f()[t]:void 0}var I=b.map((e,t)=>`${e}${t+1}`);var h=e=>(t,n=9,o=9)=>{let s=Math.floor(n*(t[0]-e.left)/e.width),l=Math.floor(o*(t[1]-e.top)/e.height);return s>=0&&s<n&&l>=0&&l<=o?[s,l]:[-1,-1]},x=e=>e,O=()=>{let t=f().slice(0,6),n=new Map;return K.map((o,s)=>{let l=t[s];n.set(l,o)}),n},Q=e=>{let{userInput:t,solutions:n}=e,o=n.keys(),s=!1;for(let l of o){if(t.get(l)==="0")return!1;s=!0}return s},q=e=>{let t=Math.floor(e/60),n=e%60,o=s=>s.toString().padStart(2,"0");return`${o(t)}:${o(n)}`};function C(e){let t=e.wrap.getBoundingClientRect(),n=e.container,o=Math.floor(t.width*window.devicePixelRatio/9)*9/window.devicePixelRatio;o-=o*.3,n.style.width=o+"px",n.style.height=o+"px",n.style.aspectRatio="1 / 1",e.bounds.clear()}function F(e){let t=document.createElement("container");if(!t)throw new Error('Not HtmlElement found with id "container"');let n=document.createElement("board");t.appendChild(n);let o=document.createElement("numpad");o.id="numpad";let s=document.createElement("head");s.id="aside";let l=document.createElement("section");l.id="aside";let r=document.createElement("article");r.classList.add("panel"),r.id="panel",l.appendChild(r),l.appendChild(o),e.wrap.append(t),e.wrap.appendChild(l);let a=H(()=>t.getBoundingClientRect());e={...e,board:n,numPad:o,bounds:a,container:t,aside:l,nav:r};let i=d=>{window.requestAnimationFrame(()=>{!Array.isArray(d)||!d.length||e.container&&(C(e),L(e))})};return new ResizeObserver(i).observe(e.wrap),e}function Z(e){let{aside:t,nav:n,buttons:o,bounds:s}=e;C(e),e.nav.innerHTML="",t.style.maxWidth=`${e.bounds().width}px`,console.log(e.bounds().width);let l=null;for(let[d,u]of o){let m=document.createElement("button");m.style.height=`${s().height/9}px`,m.style.width=`${s().width/3-1}px`,m.id=`${u.replace(/\s/g,"-")}`.toLowerCase(),m.classList.add(d),m.innerText=`${u.replace(/\s/g,"-")}`,m.style.aspectRatio="1 / 1",m.classList.add("buttons"),n.append(m),l=m}let r=document.createElement("section");r.style.height=`${s().height/9}px`,r.style.width=`${s().width/3-1}px`,r.classList.add("buttons"),r.classList.add("timer"),r.id="timer";let a=document.createElement("p");if(!l)throw Error("Could found the button");l=n.replaceChild(r,l),r.appendChild(a),e.gameState==="isInitialed"&&(a.textContent="00:00");let i=e.seconds?e.seconds:0;return setInterval(()=>{e.gameState==="isPlaying"&&(a.textContent=q(e.seconds),e.seconds=i,i++)},1e3),e}function j(e){let{board:t}=e,n=document.createElement("h1");n.innerText="Game Over",n.style.width="50%",n.style.height="50%",n.style.transform=`translate(${e.bounds().width/2-90}px,${e.bounds().height/2+20}px)`,n.style.position="absolute",t.appendChild(n)}function c(e){C(e),console.log(e.bounds().width/9,"width");let{board:t,cells:n}=e;t.innerHTML="",e.gameState==="isOvered"&&j(e);let o=0;for(let[s,l]of n){let r=document.createElement("cell"),a=B(s),i=V(e,a);o%2===0?r.className+="cell-right":r.className+="cell-left",r.style.transform=`translate(${i[0]}px, ${i[1]}px)`,r.style.position="absolute",r.style.height=`${e.bounds().height/9}px`,r.style.width=`${e.bounds().width/9}px`;for(let[u,m]of e.highlight)u===s&&r.classList.add("highlighted");if(e.selected.map(u=>{u===s&&(r.classList.remove("highlighted"),r.classList.remove("duplicates"),r.classList.add("selected"))}),e.duplicates.size>1)for(let[u,m]of e.duplicates)s===u&&(r.classList.remove("highlighted"),r.classList.remove("selected"),r.classList.add("duplicates"));r.dataset.key=`${s}`,r.dataset.value=`${l}`,(s.startsWith("a")||s.startsWith("d")||s.startsWith("g"))&&r.classList.add("vertical-lines-left"),s.startsWith("i")&&r.classList.add("vertical-lines-right"),(s[1]==="1"||s[1]==="4"||s[1]==="7")&&r.classList.add("horizontal-lines-top"),s[1]==="9"&&r.classList.add("horizontal-lines-bottom");let d=document.createElement("p");d.style.gridArea="2 / 2 / 3 / 3",l!=="0"&&e.gameState!=="isInitialed"&&(d.innerHTML=`${l}`),e.gameState==="isPaused"&&(d.style.opacity="0"),r.appendChild(d),t.appendChild(r),e.originCell.get(s)!=="0"&&e.originCell.get(s)?r.classList.add("origin-cells"):(r.classList.remove("origin-cells"),r.classList.add("new-cells")),(e.gameState==="isOvered"||e.gameState==="isPaused")&&(r.style.opacity="0.3"),ee(e,r)}return o++,e}var S=e=>t=>{let n=e.selected?.map(l=>`${l.slice(0,2)}${t}`),o=new Set([...n]);if(e.notes.filter(l=>o.has(l)).length>0){e.notes=e.notes.filter(l=>!o.has(l));return}e.notes=[...new Set([...e.notes,...n])],e.notes=[...new Set([...e.notes])],e.notes=[...e.notes,...new Set(n.filter((l,r)=>e.notes[r]==l))]};function ee(e,t){let{notes:n}=e;return n=[...new Set(n)],n.map(o=>{let s=+o.slice(-1),l=o.slice(0,2);if(!t.dataset.key?.startsWith(l)||t.dataset.value!=="0")return;let[r,a]=A(s),i=document.createElement("note");i.style.gridColumn=`${a} / 3`,i.style.gridRow=`${r} / 3`,i.innerHTML=`${s}`,t?.appendChild(i)}),e}var te=e=>{let{bounds:t,numPad:n}=e;n.innerHTML="";for(let[o,s]of e.digits){let l=document.createElement("button");l.classList.add("num"),l.style.height=`${t().height/9}px`,l.dataset.value=`${s}`,l.innerHTML=`${s}`,l.dataset.key=`${o}`,l.style.aspectRatio=`${1/1}`,n.appendChild(l)}return e},ne=e=>p(te(e)).map(G).fold(x),oe=e=>p(e).map(ne).map(Z).map(W).fold(x),L=e=>p(e).map(c).map(oe).fold(x);var U=e=>{let{board:t}=e;return t.addEventListener("pointerdown",n=>{let{clientX:o,clientY:s}=n,l=h(e.bounds())([o,s]),r=y(l);if(!r)return;e.highlight=k(e)(r);let a=D(e)(r);if(a)if(a.dataset.value==="0")n.ctrlKey?e.selected=[...new Set(e.selected),r]:e.selected=[...new Set([r])],e.isHold=!0,c(e);else{e.isDragging=!0,e.draggingElement=a,e.selected=e.selected=[...new Set([r])],e.draggingElement.classList.add("selected");let i=e.draggingElement.dataset.value;if(!i)return;e.draggingValue=i}}),t.addEventListener("pointerup",n=>{let{clientX:o,clientY:s}=n;e.isHold=!1;let l=h(e.bounds())([o,s]),r=y(l);if(r){if(e.targetKey=r,e.selected=[...new Set([...e.selected,r])],e.isDragging&&e.draggingElement){let a=e.draggingElement?.firstChild;e.draggingElement&&a&&(a.style.position="unset",a.style.transform="unset"),e.draggingElement.classList.remove("selected"),t.querySelectorAll(".selected").forEach(d=>d.classList.remove("selected"));let i=e.draggingValue;e.isNote?S(e)(i):g(e,i)}e.draggingElement=void 0,e.isDragging=!1,e.draggingValue=void 0,c(e)}}),t.addEventListener("pointermove",n=>{let{clientX:o,clientY:s}=n;if(e.isHold){let l=h(e.bounds())([o,s]),r=y(l);if(!r)return;e.selected=[...new Set(e.selected),r],e.selected=[...new Set(e.selected)],c(e)}if(e.isDragging){let l=e.draggingElement?.firstChild;e.draggingElement&&l&&(l.style.position="absolute",l.style.transform=`translate(${o-e.draggingElement?.getBoundingClientRect().left-e.draggingElement?.getBoundingClientRect().width/3}px, ${s-e.draggingElement?.getBoundingClientRect().top-e.draggingElement?.getBoundingClientRect().height/3}px)`)}}),e},G=e=>{let{numPad:t}=e;return t.querySelectorAll("*").forEach(n=>{let o=n;o.addEventListener("click",()=>{let s=o.dataset.value;s&&(e.isNote?S(e)(s):g(e,s),c(e))})}),e};function _(e){let{nav:t}=e;return document.addEventListener("keydown",n=>{if(n.key==="r"&&document.location.reload(),e.gameState==="isInitialed"&&n.key==="s"&&(e.gameState="isPlaying",c(e)),e.gameState==="isPlaying"&&n.key==="n"){e.isNote=!e.isNote;let l=t.querySelector("#note");e.isNote?l.classList.add("btn-pressed"):l.classList.remove("btn-pressed")}let o=n.key[0];if(o.match(/\d/))if(e.isNote){if(!e.targetKey)return;S(e)(o)}else g(e,`${o}`);c(e)}),e}function W(e){let{nav:t}=e,n=t.querySelector("#start");if(!n)return e;n.addEventListener("pointerdown",()=>{if(e.gameState==="isInitialed"){e.gameState="isPlaying";let i=t.querySelector("#start");i.innerText="Pause",c(e)}else if(e.gameState==="isPaused"){e.gameState="isPlaying";let i=t.querySelector("#start");i.innerText="Pause",c(e)}else if(e.gameState==="isPlaying"){e.gameState="isPaused";let i=t.querySelector("#start");i.innerText="Resume",c(e)}c(e)}),t.querySelector("#restart").addEventListener("pointerdown",()=>{document.location.reload()});let s=t.querySelector("#note");s.addEventListener("pointerdown",()=>{e.isNote=!e.isNote,e.isNote?s.classList.add("btn-pressed"):s.classList.remove("btn-pressed")}),t.querySelector("#remove").addEventListener("pointerdown",()=>{e.isNote||e.selected.map(d=>{e.originCell.get(d)!=="0"||(e.cells.set(d,"0"),e.duplicates=new Map)});let i=e.selected.map(d=>e.notes.filter(u=>d.slice(0,2)===u.slice(0,2))).flat();e.notes=e.notes.filter(d=>!i.includes(d)),c(e)}),t.querySelector("#hint").addEventListener("pointerdown",()=>{e.gameState==="isPlaying"&&e.selected.map(d=>{let u=e.solutions.get(d);g(e,u)})});let a=t.querySelector("#timer");return a&&a.addEventListener("pointerdown",()=>{a.firstChild.classList.toggle("hide")}),e}function z(e,t,n,o){for(let s=0;s<3;s++)for(let l=0;l<3;l++)if(e[t+s][n+l]===o)return!1;return!0}function se(e,t,n){let o;for(let s=0;s<3;s++)for(let l=0;l<3;l++){do o=Math.floor(Math.random()*9)+1;while(!z(e,t,n,o));e[t+s][n+l]=o}}function le(e,t,n){for(let o=0;o<9;o++)if(e[t][o]===n)return!1;return!0}function re(e,t,n){for(let o=0;o<9;o++)if(e[o][t]===n)return!1;return!0}function ie(e,t,n,o){return le(e,t,o)&&re(e,n,o)&&z(e,t-t%3,n-n%3,o)}function ae(e){for(let t=0;t<9;t+=3)se(e,t,t)}function w(e,t,n){if(t===9)return!0;if(n===9)return w(e,t+1,0);if(e[t][n]!==0)return w(e,t,n+1);for(let o=1;o<=9;o++)if(ie(e,t,n,o)){if(e[t][n]=o,w(e,t,n+1))return!0;e[t][n]=0}return!1}function de(e,t){let n=new Map;for(;t>0;){let o=Math.floor(Math.random()*81),s=Math.floor(o/9),l=o%9;e[s][l]!==0&&(n.set($([s,l]),e[s][l]),e[s][l]=0,t--)}return n}function X(e){let t=new Array(9).fill(0).map(()=>new Array(9).fill(0));return ae(t),w(t,0,0),{grid:t,solution:de(t,e)}}function ce(){let e=new Map;return I.map((t,n)=>{let o=t,s=+(n+1);e.set(o,s)}),e}var ue=(e,t)=>{let n=me(),o=new Map([...n.cells]),s=new Map;return[...n.solutions.keys()].map(i=>s.set(i,"0")),{...{gameState:"isInitialed",cells:o,originCell:n.cells,selected:[],digits:ce(),notes:[],buttons:O(),isNote:!1,isDragging:!1,isHold:!1,highlight:new Map,duplicates:new Map,solutions:n.solutions,userInput:s,seconds:0},wrap:e}},me=()=>{let e=new Map,t=X(50),n=t.grid.flat(),o=t.solution;return f().map((s,l)=>{let r=Math.floor(l/9),a=l%9,i=Math.floor(r/3)*3+Math.floor(a/3)+1,d=s.replace(/.$/,`${i}`);e.set(d,`${n[l]}`)}),{cells:e,solutions:o}};function Te(e,t){return p(ue(e,t)).map(F).map(L).map(U).map(_)}export{Te as Sudoku,me as getCells,ce as getDigits,ue as initState};
