var K=["1","2","3","4","5","6","7","8","9"],E=["a","b","c","d","e","f","g","h","i"],T=["start","restart","remove","note","hint","timer"];var p=e=>({map:t=>p(t(e)),fold:t=>t(e),toString:()=>e}),H=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],f=()=>{let e=0;return E.map(t=>K.map(n=>{let o=Math.floor(e/9),s=e%9,l=Math.floor(o/3)*3+Math.floor(s/3)+1;return e++,`${t}${n}${l}`})).flat()};function Q(e){let t=new Map;for(let[o,s]of e.entries())t.has(s)||t.set(s,[]),t.get(s).push(o);let n=[];for(let o of t.values())o.length>1&&n.push(...o);return n}var v=e=>t=>f().map(n=>Q(t(n,!0)).map(o=>{if(o){let s=e.cells.get(o);e.duplicates.set(o,`${s}`)}else e.duplicates.delete(o);return e.duplicates}).flat()).flat(),Z=e=>{v(e)(R(e)),v(e)(N(e)),v(e)(V(e))},g=(e,t)=>{e.duplicates=new Map,e.targetKey&&(e.selected.map(n=>{e.originCell.get(n)!=="0"&&e.originCell.get(n)||(e.cells.set(n,`${t}`),e.userInput.set(n,`${t}`),j(e)&&(e.gameState="isOvered"))}),e.highlight=k(e)(e.targetKey),Z(e),d(e))},$=e=>{let t=f();return e.every(n=>n>=0&&n<=8)?t[9*e[0]+e[1]]:void 0};function P(e){let t,n=()=>(t===void 0&&(t=e()),t);return n.clear=()=>{t=void 0},n}var L=e=>(t,n=!1)=>o=>{let s=new Map;for(let[l,i]of e.cells)if(l[o]===t[o]){if(n&&i==="0")continue;s.set(l,i)}return s},R=e=>(t,n=!1)=>L(e)(t,n)(0),N=e=>(t,n=!1)=>L(e)(t,n)(1),V=e=>(t,n=!1)=>L(e)(t,n)(2),k=e=>(t,n=!1)=>new Map([...R(e)(t,n),...N(e)(t,n),...V(e)(t,n)]),A=(e,t)=>{let n=e.bounds().width*t[0]/9,o=e.bounds().height*t[1]/9;return[n,o]},D=e=>{let t=Math.ceil(e/3),n=(e-1)%3+1;return[t,n]},I=e=>t=>{let{board:n}=e,o=n.firstChild;for(;o;){if(o.dataset.key?.startsWith(t))return o;o=o.nextSibling}return null};function y(e){let t=9*e[0]+e[1];return e.every(n=>n>=0&&n<=9)?f()[t]:void 0}var O=E.map((e,t)=>`${e}${t+1}`);var h=e=>(t,n=9,o=9)=>{let s=Math.floor(n*(t[0]-e.left)/e.width),l=Math.floor(o*(t[1]-e.top)/e.height);return s>=0&&s<n&&l>=0&&l<=o?[s,l]:[-1,-1]},x=e=>e,q=()=>{let t=f().slice(0,6),n=new Map;return T.map((o,s)=>{let l=t[s];n.set(l,o)}),n},j=e=>{let{userInput:t,solutions:n}=e,o=n.keys(),s=!1;for(let l of o){if(t.get(l)==="0")return!1;s=!0}return s},F=e=>{let t=Math.floor(e/60),n=e%60,o=s=>s.toString().padStart(2,"0");return`${o(t)}:${o(n)}`};function M(e){let t=e.wrap.getBoundingClientRect(),n=e.container,o=Math.floor(t.width*window.devicePixelRatio/9)*9/window.devicePixelRatio;o-=o*.3,n.style.width=o+"px",n.style.height=o+"px",n.style.aspectRatio="1 / 1",e.bounds.clear()}function G(e){let t=document.createElement("container");if(!t)throw new Error('Not HtmlElement found with id "container"');let n=document.createElement("board");t.appendChild(n);let o=document.createElement("numpad");o.id="numpad";let s=document.createElement("head");s.id="aside";let l=document.createElement("section");l.id="aside";let i=document.createElement("article");i.classList.add("panel"),i.id="panel",l.appendChild(i),l.appendChild(o),e.wrap.append(t),e.wrap.appendChild(l);let a=P(()=>t.getBoundingClientRect());e={...e,board:n,numPad:o,bounds:a,container:t,aside:l,nav:i};let r=c=>{window.requestAnimationFrame(()=>{!Array.isArray(c)||!c.length||e.container&&(M(e),C(e))})};return new ResizeObserver(r).observe(e.wrap),e}function ee(e){let{aside:t,nav:n,buttons:o,bounds:s}=e,l=['<i class="fa-solid fa-play"></i>','<i class="fa-solid fa-arrows-rotate"></i>','<i class="fa-solid fa-x"></i>','<i class="fa-solid fa-pen"></i>','<i class="fa-solid fa-eye"></i>'];M(e),e.nav.innerHTML="",t.style.maxWidth=`${e.bounds().width}px`,console.log(e.bounds().width);let i=0,a=null;for(let[b,J]of o){let m=document.createElement("button");m.style.height=`${s().height/9}px`,m.style.width=`${s().width/3-1}px`,m.id=`${J.replace(/\s/g,"-")}`.toLowerCase(),m.classList.add(b),m.innerHTML=l[i++],m.style.aspectRatio="1 / 1",m.classList.add("buttons"),n.append(m),a=m}let r=document.createElement("section");r.style.height=`${s().height/9}px`,r.style.width=`${s().width/3-1}px`,r.classList.add("buttons"),r.classList.add("timer"),r.id="timer";let c=document.createElement("p");if(!a)throw Error("Could found the button");a=n.replaceChild(r,a),r.appendChild(c),e.gameState==="isInitialed"&&(c.textContent="00:00");let u=e.seconds?e.seconds:0;return setInterval(()=>{e.gameState==="isPlaying"&&(c.textContent=F(e.seconds),e.seconds=u,u++)},1e3),e}function te(e){let{board:t}=e,n=document.createElement("h1");n.innerText="Game Over",n.style.width="50%",n.style.height="50%",n.style.transform=`translate(${e.bounds().width/2-90}px,${e.bounds().height/2+20}px)`,n.style.position="absolute",t.appendChild(n)}function d(e){M(e),console.log(e.bounds().width/9,"width");let{board:t,cells:n}=e;t.innerHTML="",e.gameState==="isOvered"&&te(e);let o=0;for(let[s,l]of n){let i=document.createElement("cell"),a=H(s),r=A(e,a);o%2===0?i.className+="cell-right":i.className+="cell-left",i.style.transform=`translate(${r[0]}px, ${r[1]}px)`,i.style.position="absolute",i.style.height=`${e.bounds().height/9}px`,i.style.width=`${e.bounds().width/9}px`;for(let[u,b]of e.highlight)u===s&&i.classList.add("highlighted");if(e.selected.map(u=>{u===s&&(i.classList.remove("highlighted"),i.classList.remove("duplicates"),i.classList.add("selected"))}),e.duplicates.size>1)for(let[u,b]of e.duplicates)s===u&&(i.classList.remove("highlighted"),i.classList.remove("selected"),i.classList.add("duplicates"));i.dataset.key=`${s}`,i.dataset.value=`${l}`,(s.startsWith("a")||s.startsWith("d")||s.startsWith("g"))&&i.classList.add("vertical-lines-left"),s.startsWith("i")&&i.classList.add("vertical-lines-right"),(s[1]==="1"||s[1]==="4"||s[1]==="7")&&i.classList.add("horizontal-lines-top"),s[1]==="9"&&i.classList.add("horizontal-lines-bottom");let c=document.createElement("p");c.style.gridArea="2 / 2 / 3 / 3",l!=="0"&&e.gameState!=="isInitialed"&&(c.innerHTML=`${l}`),e.gameState==="isPaused"&&(c.style.opacity="0"),i.appendChild(c),t.appendChild(i),e.originCell.get(s)!=="0"&&e.originCell.get(s)?i.classList.add("origin-cells"):(i.classList.remove("origin-cells"),i.classList.add("new-cells")),(e.gameState==="isOvered"||e.gameState==="isPaused")&&(i.style.opacity="0.3"),ne(e,i)}return o++,e}var w=e=>t=>{let n=e.selected?.map(l=>`${l.slice(0,2)}${t}`),o=new Set([...n]);if(e.notes.filter(l=>o.has(l)).length>0){e.notes=e.notes.filter(l=>!o.has(l));return}e.notes=[...new Set([...e.notes,...n])],e.notes=[...new Set([...e.notes])],e.notes=[...e.notes,...new Set(n.filter((l,i)=>e.notes[i]==l))]};function ne(e,t){let{notes:n}=e;return n=[...new Set(n)],n.map(o=>{let s=+o.slice(-1),l=o.slice(0,2);if(!t.dataset.key?.startsWith(l)||t.dataset.value!=="0")return;let[i,a]=D(s),r=document.createElement("note");r.style.gridColumn=`${a} / 3`,r.style.gridRow=`${i} / 3`,r.innerHTML=`${s}`,t?.appendChild(r)}),e}var oe=e=>{let{bounds:t,numPad:n}=e;n.innerHTML="";for(let[o,s]of e.digits){let l=document.createElement("button");l.classList.add("num"),l.style.height=`${t().height/9}px`,l.dataset.value=`${s}`,l.innerHTML=`${s}`,l.dataset.key=`${o}`,l.style.aspectRatio=`${1/1}`,n.appendChild(l)}return e},se=e=>p(oe(e)).map(W).fold(x),le=e=>p(e).map(se).map(ee).map(U).fold(x),C=e=>p(e).map(d).map(le).fold(x);var _=e=>{let{board:t}=e;return t.addEventListener("pointerdown",n=>{let{clientX:o,clientY:s}=n,l=h(e.bounds())([o,s]),i=y(l);if(!i)return;e.highlight=k(e)(i);let a=I(e)(i);if(a)if(a.dataset.value==="0")n.ctrlKey?e.selected=[...new Set(e.selected),i]:e.selected=[...new Set([i])],e.isHold=!0,d(e);else{e.isDragging=!0,e.draggingElement=a,e.selected=e.selected=[...new Set([i])],e.draggingElement.classList.add("selected");let r=e.draggingElement.dataset.value;if(!r)return;e.draggingValue=r}}),t.addEventListener("pointerup",n=>{let{clientX:o,clientY:s}=n;e.isHold=!1;let l=h(e.bounds())([o,s]),i=y(l);if(i){if(e.targetKey=i,e.selected=[...new Set([...e.selected,i])],e.isDragging&&e.draggingElement){let a=e.draggingElement?.firstChild;e.draggingElement&&a&&(a.style.position="unset",a.style.transform="unset"),e.draggingElement.classList.remove("selected"),t.querySelectorAll(".selected").forEach(c=>c.classList.remove("selected"));let r=e.draggingValue;e.isNote?w(e)(r):g(e,r)}e.draggingElement=void 0,e.isDragging=!1,e.draggingValue=void 0,d(e)}}),t.addEventListener("pointermove",n=>{let{clientX:o,clientY:s}=n;if(e.isHold){let l=h(e.bounds())([o,s]),i=y(l);if(!i)return;e.selected=[...new Set(e.selected),i],e.selected=[...new Set(e.selected)],d(e)}if(e.isDragging){let l=e.draggingElement?.firstChild;e.draggingElement&&l&&(l.style.position="absolute",l.style.transform=`translate(${o-e.draggingElement?.getBoundingClientRect().left-e.draggingElement?.getBoundingClientRect().width/3}px, ${s-e.draggingElement?.getBoundingClientRect().top-e.draggingElement?.getBoundingClientRect().height/3}px)`)}}),e},W=e=>{let{numPad:t}=e;return t.querySelectorAll("*").forEach(n=>{let o=n;o.addEventListener("click",()=>{let s=o.dataset.value;s&&(e.isNote?w(e)(s):g(e,s),d(e))})}),e};function z(e){let{nav:t}=e;return document.addEventListener("keydown",n=>{if(n.key==="r"&&document.location.reload(),e.gameState==="isInitialed"&&n.key==="s"&&(e.gameState="isPlaying",d(e)),e.gameState==="isPlaying"&&n.key==="n"){e.isNote=!e.isNote;let l=t.querySelector("#note");e.isNote?l.classList.add("btn-pressed"):l.classList.remove("btn-pressed")}let o=n.key[0];if(o.match(/\d/))if(e.isNote){if(!e.targetKey)return;w(e)(o)}else g(e,`${o}`);d(e)}),e}function U(e){let{nav:t}=e,n=t.querySelector("#start");if(!n)return e;n.addEventListener("pointerdown",()=>{if(e.gameState==="isInitialed"){e.gameState="isPlaying";let r=t.querySelector("#start");r.innerHTML='<i class="fa-solid fa-circle-pause"></i>',d(e)}else if(e.gameState==="isPaused"){e.gameState="isPlaying";let r=t.querySelector("#start");r.innerHTML='<i class="fa-solid fa-circle-pause"></i>',d(e)}else if(e.gameState==="isPlaying"){e.gameState="isPaused";let r=t.querySelector("#start");r.innerHTML='<i class="fa-solid fa-forward"></i>',d(e)}d(e)}),t.querySelector("#restart").addEventListener("pointerdown",()=>{document.location.reload()});let s=t.querySelector("#note");s.addEventListener("pointerdown",()=>{e.isNote=!e.isNote,e.isNote?s.classList.add("btn-pressed"):s.classList.remove("btn-pressed")}),t.querySelector("#remove").addEventListener("pointerdown",()=>{e.isNote||e.selected.map(c=>{e.originCell.get(c)!=="0"||(e.cells.set(c,"0"),e.duplicates=new Map)});let r=e.selected.map(c=>e.notes.filter(u=>c.slice(0,2)===u.slice(0,2))).flat();e.notes=e.notes.filter(c=>!r.includes(c)),d(e)}),t.querySelector("#hint").addEventListener("pointerdown",()=>{e.gameState==="isPlaying"&&e.selected.map(c=>{let u=e.solutions.get(c);g(e,u)})});let a=t.querySelector("#timer");return a&&a.addEventListener("pointerdown",()=>{a.firstChild.classList.toggle("hide")}),e}function X(e,t,n,o){for(let s=0;s<3;s++)for(let l=0;l<3;l++)if(e[t+s][n+l]===o)return!1;return!0}function ie(e,t,n){let o;for(let s=0;s<3;s++)for(let l=0;l<3;l++){do o=Math.floor(Math.random()*9)+1;while(!X(e,t,n,o));e[t+s][n+l]=o}}function re(e,t,n){for(let o=0;o<9;o++)if(e[t][o]===n)return!1;return!0}function ae(e,t,n){for(let o=0;o<9;o++)if(e[o][t]===n)return!1;return!0}function ce(e,t,n,o){return re(e,t,o)&&ae(e,n,o)&&X(e,t-t%3,n-n%3,o)}function de(e){for(let t=0;t<9;t+=3)ie(e,t,t)}function S(e,t,n){if(t===9)return!0;if(n===9)return S(e,t+1,0);if(e[t][n]!==0)return S(e,t,n+1);for(let o=1;o<=9;o++)if(ce(e,t,n,o)){if(e[t][n]=o,S(e,t,n+1))return!0;e[t][n]=0}return!1}function ue(e,t){let n=new Map;for(;t>0;){let o=Math.floor(Math.random()*81),s=Math.floor(o/9),l=o%9;e[s][l]!==0&&(n.set($([s,l]),e[s][l]),e[s][l]=0,t--)}return n}function Y(e){let t=new Array(9).fill(0).map(()=>new Array(9).fill(0));return de(t),S(t,0,0),{grid:t,solution:ue(t,e)}}function me(){let e=new Map;return O.map((t,n)=>{let o=t,s=+(n+1);e.set(o,s)}),e}var pe=(e,t)=>{let n=fe(),o=new Map([...n.cells]),s=new Map;return[...n.solutions.keys()].map(r=>s.set(r,"0")),{...{gameState:"isInitialed",cells:o,originCell:n.cells,selected:[],digits:me(),notes:[],buttons:q(),isNote:!1,isDragging:!1,isHold:!1,highlight:new Map,duplicates:new Map,solutions:n.solutions,userInput:s,seconds:0},wrap:e}},fe=()=>{let e=new Map,t=Y(50),n=t.grid.flat(),o=t.solution;return f().map((s,l)=>{let i=Math.floor(l/9),a=l%9,r=Math.floor(i/3)*3+Math.floor(a/3)+1,c=s.replace(/.$/,`${r}`);e.set(c,`${n[l]}`)}),{cells:e,solutions:o}};function He(e,t){return p(pe(e,t)).map(G).map(C).map(_).map(z)}export{He as Sudoku,fe as getCells,me as getDigits,pe as initState};
